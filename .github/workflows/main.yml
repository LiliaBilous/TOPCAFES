name: Deploy to Github Pages
run-name: TOPCAFES

on:
  push:
    branches:
      - "main"


jobs:
  # –†–æ–±–æ—Ç–∞ –∑—ñ –∑–±—ñ—Ä–∫–æ—é —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è–º
  build:
    name: Build # Defines the name of the build job.
    runs-on: ubuntu-latest # Specifies the operating system for the job.
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        # –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Node.js –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

      - name: Install Dependencies
        run: npm install
        # –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø–∞–∫–µ—Ç—ñ–≤

      - name: Build
        run: npm run build
        env:
          PUBLIC_API_URL: https://liliabilous.github.io/TOPCAFES/
        # –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç—É, –∫–æ–º–∞–Ω–¥–∞ `npm run build` –∑–∞–ø—É—Å–∫–∞—î —Å–∫—Ä–∏–ø—Ç, —â–æ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —É –≤–∞—à–æ–º—É `package.json`

      - name: Set up Git
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Git –¥–ª—è –∫–æ–º—ñ—Ç—ñ–≤

      - name: Save changes and switch branches
        run: |
          git fetch origin
          git add .
          git commit -m "Save current changes before switching branches" || echo "No changes to commit"
          git checkout gh-pages-demo || git checkout -b gh-pages-demo
          git pull origin gh-pages-demo
        # –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–∏—Ö –∑–º—ñ–Ω, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞ –≥—ñ–ª–∫—É `gh-pages-demo`, —è–∫—â–æ –≤–æ–Ω–∞ —ñ—Å–Ω—É—î, —ñ –ø—É–ª –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–º—ñ–Ω

      - name: Copy and deploy
        run: |
          cp -r dist/* .
          git add .
          git commit -m "Deploy to gh-pages-demo branch" || echo "No changes to commit"
          git push origin gh-pages-demo
        # –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑—ñ–±—Ä–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ `dist`, –∫–æ–º—ñ—Ç —ñ –ø—É—à –Ω–∞ –≥—ñ–ª–∫—É `gh-pages-demo`

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: ./dist
        # –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑ –ø–∞–ø–∫–∏ `dist` –Ω–∞ GitHub Pages
