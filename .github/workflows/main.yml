name: TOPCAFES
run-name: TOPCAFES

on:
  # –ó–∞–ø—É—Å–∫–∞—î workflow –ø—Ä–∏ –ø—É—à–∞—Ö –≤ –æ—Å–Ω–æ–≤–Ω—É –≥—ñ–ª–∫—É
  push:
    branches:
      - 'main'

  # –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ü–µ–π workflow –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫—É Actions –≤ GitHub
  workflow_dispatch:

# –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç
permissions:
  contents: write

# –î–æ–∑–≤–æ–ª—è—î –æ–¥–Ω–æ—á–∞—Å–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ —Å–∫–∞—Å–æ–≤—É—î –ø–æ—Ç–æ—á–Ω–µ, —è–∫—â–æ —î –Ω–æ–≤–µ
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  # –†–æ–±–æ—Ç–∞ –∑—ñ –∑–±—ñ—Ä–∫–æ—é —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è–º
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        # –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

      - uses: actions/setup-node@v4
        with:
          version: 20
        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Node.js –≤–µ—Ä—Å—ñ—ó 20

      - name: Install Dependencies
        run: npm install
        # –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø–∞–∫–µ—Ç—ñ–≤

      - name: Build
        run: npm run build
        env:
          PUBLIC_API_URL: https://liliabilous.github.io/TOPCAFES/
        # –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç—É, –∫–æ–º–∞–Ω–¥–∞ `npm run build` –∑–∞–ø—É—Å–∫–∞—î —Å–∫—Ä–∏–ø—Ç, —â–æ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —É –≤–∞—à–æ–º—É `package.json`

      - name: Copy to gh-pages-demo branch
        run: |
          git fetch origin
          git checkout gh-pages-demo
          git pull origin gh-pages-demo
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          cp -r dist/* .
          git add .
          git commit -m "Deploy to gh-pages-demo branch" || echo "No changes to commit"
          git push origin gh-pages-demo
        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Git –¥–ª—è –∫–æ–º—ñ—Ç—ñ–≤, –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –Ω–∞ –≥—ñ–ª–∫—É `gh-pages-demo`, –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑—ñ–±—Ä–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ `dist`, –∫–æ–º—ñ—Ç —ñ –ø—É—à

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: ./dist
        # –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑ –ø–∞–ø–∫–∏ `dist` –Ω–∞ GitHub Pages
